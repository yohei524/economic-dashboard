{% extends "base.html" %}

{% block title %}é›‡ç”¨çµ±è¨ˆ {{ month }} | çµŒæ¸ˆæŒ‡æ¨™ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-white">ğŸ“Š é›‡ç”¨çµ±è¨ˆï¼ˆNFPï¼‰</h1>
            <p class="text-gray-400 mt-1">{{ month }} åˆ†</p>
        </div>
        <!-- æœˆé¸æŠ -->
        <div class="flex items-center space-x-2">
            <select id="month-select" class="bg-trader-card border border-trader-border rounded-md px-3 py-2 text-white" onchange="location.href='/nfp/' + this.value">
                {% for nfp in all_nfp %}
                <option value="{{ nfp.month }}" {% if nfp.month == month %}selected{% endif %}>
                    {{ nfp.month }}ï¼ˆ{{ nfp.date }}ç™ºè¡¨ï¼‰
                </option>
                {% endfor %}
            </select>
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³æƒ…å ± -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- äºˆæƒ³ãƒ»çµæœã‚«ãƒ¼ãƒ‰ -->
        <div class="bg-trader-card border border-trader-border rounded-lg p-6">
            <h2 class="text-lg font-bold text-white mb-4">ğŸ“ˆ ãƒ‡ãƒ¼ã‚¿</h2>

            {% if schedule %}
            <div class="mb-4">
                <p class="text-gray-400 text-sm">ç™ºè¡¨æ—¥æ™‚</p>
                <p class="text-white text-xl">{{ schedule.date }} 22:30 JST</p>
            </div>
            {% endif %}

            <div class="grid grid-cols-3 gap-4 mt-6">
                <div class="text-center p-4 bg-trader-border/30 rounded-lg">
                    <p class="text-gray-400 text-sm">å‰å›</p>
                    <p class="text-2xl font-bold text-white">
                        {% if data.prev %}{{ data.prev }}ä¸‡{% else %}-{% endif %}
                    </p>
                </div>
                <div class="text-center p-4 bg-trader-blue/20 rounded-lg border border-trader-blue/50">
                    <p class="text-gray-400 text-sm">äºˆæƒ³</p>
                    <p class="text-2xl font-bold text-trader-blue">
                        {% if data.forecast %}{{ data.forecast }}ä¸‡{% else %}-{% endif %}
                    </p>
                </div>
                <div class="text-center p-4 {% if data.actual %}{% if data.actual > data.forecast %}bg-trader-green/20 border border-trader-green/50{% else %}bg-trader-red/20 border border-trader-red/50{% endif %}{% else %}bg-trader-border/30{% endif %} rounded-lg">
                    <p class="text-gray-400 text-sm">çµæœ</p>
                    <p class="text-2xl font-bold {% if data.actual %}{% if data.actual > data.forecast %}text-trader-green{% else %}text-trader-red{% endif %}{% else %}text-white{% endif %}">
                        {% if data.actual %}{{ data.actual }}ä¸‡{% else %}-{% endif %}
                    </p>
                </div>
            </div>

            {% if data.actual and data.forecast %}
            <div class="mt-4 p-4 bg-trader-border/30 rounded-lg">
                <p class="text-gray-400 text-sm">ä¹–é›¢</p>
                <p class="text-xl font-bold {% if data.actual > data.forecast %}text-trader-green{% else %}text-trader-red{% endif %}">
                    {% if data.actual > data.forecast %}+{% endif %}{{ "%.1f"|format(data.actual - data.forecast) }}ä¸‡äºº
                </p>
                <p class="text-gray-400 text-sm mt-2">
                    {% if data.actual > data.forecast %}
                    äºˆæƒ³ã‚’ä¸Šå›ã‚‹ â†’ ãƒ‰ãƒ«è²·ã„ï¼ˆã‚»ã‚ªãƒªãƒ¼ï¼‰
                    {% else %}
                    äºˆæƒ³ã‚’ä¸‹å›ã‚‹ â†’ ãƒ‰ãƒ«å£²ã‚Šï¼ˆã‚»ã‚ªãƒªãƒ¼ï¼‰
                    {% endif %}
                </p>
            </div>
            {% endif %}

            {% if data.market_reaction %}
            <div class="mt-4 p-4 bg-trader-border/30 rounded-lg">
                <p class="text-gray-400 text-sm">å¸‚å ´åå¿œ</p>
                <p class="text-xl font-bold text-white">{{ data.market_reaction }}</p>
            </div>
            {% endif %}

            {% if data.notes %}
            <div class="mt-4 p-4 bg-trader-border/30 rounded-lg">
                <p class="text-gray-400 text-sm">ãƒ¡ãƒ¢</p>
                <p class="text-white">{{ data.notes }}</p>
            </div>
            {% endif %}
        </div>

        <!-- ç™ºè¡¨ç›´å¾Œã®å€¤å‹•ã -->
        <div class="bg-trader-card border border-trader-border rounded-lg p-6">
            <h2 class="text-lg font-bold text-white mb-4">ğŸ“‰ ç™ºè¡¨ç›´å¾Œã®å€¤å‹•ã</h2>

            {% if data.price_moves %}
            <div class="mb-4">
                <p class="text-gray-400 text-sm">ç™ºè¡¨æ™‚ USD/JPY</p>
                <p class="text-2xl font-bold text-white">{{ data.price_moves.release_price }}</p>
            </div>

            <div class="space-y-2">
                {% for label, move in data.price_moves.moves.items() %}
                <div class="flex items-center justify-between p-3 bg-trader-border/30 rounded-lg">
                    <span class="text-gray-400">
                        {% if label == '5min_after' %}5åˆ†å¾Œ
                        {% elif label == '15min_after' %}15åˆ†å¾Œ
                        {% elif label == '30min_after' %}30åˆ†å¾Œ
                        {% elif label == '1h_after' %}1æ™‚é–“å¾Œ
                        {% else %}{{ label }}{% endif %}
                    </span>
                    <div class="text-right">
                        <span class="text-white">{{ move.price }}</span>
                        <span class="ml-2 font-bold {% if move.pips >= 0 %}text-trader-green{% else %}text-trader-red{% endif %}">
                            {% if move.pips >= 0 %}+{% endif %}{{ move.pips }}pips
                        </span>
                    </div>
                </div>
                {% endfor %}
            </div>

            <div class="mt-4 p-4 {% if data.price_moves.max_move >= 0 %}bg-trader-green/20 border border-trader-green/50{% else %}bg-trader-red/20 border border-trader-red/50{% endif %} rounded-lg">
                <p class="text-gray-400 text-sm">æœ€å¤§å¤‰å‹•</p>
                <p class="text-3xl font-bold {% if data.price_moves.max_move >= 0 %}text-trader-green{% else %}text-trader-red{% endif %}">
                    {% if data.price_moves.max_move >= 0 %}+{% endif %}{{ data.price_moves.max_move }}pips
                </p>
            </div>
            {% else %}
            <p class="text-gray-500 text-center py-8">å€¤å‹•ããƒ‡ãƒ¼ã‚¿ãªã—</p>
            {% endif %}
        </div>
    </div>

    <!-- é–¢é€£FRBç™ºè¨€ -->
    <div class="bg-trader-card border border-trader-border rounded-lg p-6">
        <h2 class="text-lg font-bold text-white mb-4">ğŸ¦… é–¢é€£FRBç™ºè¨€</h2>
        <p class="text-gray-400 text-sm mb-4">å‰å›NFPã€œä»Šå›NFPé–“ã®ç™ºè¨€</p>

        {% if speeches %}
        <div class="space-y-3 max-h-96 overflow-y-auto">
            {% for speech in speeches %}
            <div class="p-3 bg-trader-border/30 rounded-lg">
                <div class="flex items-center justify-between">
                    <span class="text-white font-medium">{{ speech.official }}</span>
                    <span class="text-gray-500 text-sm">{{ speech.date }}</span>
                </div>
                <p class="text-gray-300 text-sm mt-1">{{ speech.summary }}</p>
                <div class="flex items-center mt-2 space-x-2">
                    {% if speech.stance == 'hawkish' %}
                    <span class="text-xs px-2 py-0.5 rounded bg-trader-red/20 text-trader-red">ğŸ¦… ã‚¿ã‚«æ´¾</span>
                    {% elif speech.stance == 'dovish' %}
                    <span class="text-xs px-2 py-0.5 rounded bg-trader-green/20 text-trader-green">ğŸ•Šï¸ ãƒãƒˆæ´¾</span>
                    {% else %}
                    <span class="text-xs px-2 py-0.5 rounded bg-gray-500/20 text-gray-400">â– ä¸­ç«‹</span>
                    {% endif %}
                    {% if speech.market_reaction %}
                    <span class="text-xs text-gray-400">{{ speech.market_reaction }}</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-gray-500 text-center py-8">ã¾ã ç™ºè¨€ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
        {% endif %}
    </div>

    <!-- éå»ã®é›‡ç”¨çµ±è¨ˆå±¥æ­´ -->
    <div class="bg-trader-card border border-trader-border rounded-lg p-6">
        <h2 class="text-lg font-bold text-white mb-4">ğŸ“œ éå»ã®é›‡ç”¨çµ±è¨ˆ</h2>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-trader-border/50">
                    <tr>
                        <th class="px-4 py-2 text-left text-sm text-gray-400">å¯¾è±¡æœˆ</th>
                        <th class="px-4 py-2 text-right text-sm text-gray-400">äºˆæƒ³</th>
                        <th class="px-4 py-2 text-right text-sm text-gray-400">çµæœ</th>
                        <th class="px-4 py-2 text-right text-sm text-gray-400">ä¹–é›¢</th>
                        <th class="px-4 py-2 text-left text-sm text-gray-400">åå¿œ</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-trader-border">
                    {% for m, d in nfp_history.items()|sort(reverse=True) %}
                    {% if d.actual %}
                    <tr class="hover:bg-trader-border/30 {% if m == month %}bg-trader-blue/10{% endif %}">
                        <td class="px-4 py-2">
                            <a href="/nfp/{{ m }}" class="text-trader-blue hover:underline">{{ m }}</a>
                        </td>
                        <td class="px-4 py-2 text-right text-white">{{ d.forecast }}ä¸‡</td>
                        <td class="px-4 py-2 text-right {% if d.actual > d.forecast %}text-trader-green{% else %}text-trader-red{% endif %}">
                            {{ d.actual }}ä¸‡
                        </td>
                        <td class="px-4 py-2 text-right {% if d.actual > d.forecast %}text-trader-green{% else %}text-trader-red{% endif %}">
                            {% if d.actual > d.forecast %}+{% endif %}{{ "%.1f"|format(d.actual - d.forecast) }}
                        </td>
                        <td class="px-4 py-2 text-gray-400 text-sm">{{ d.market_reaction or '-' }}</td>
                    </tr>
                    {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- ãƒˆãƒ¬ãƒ¼ãƒ‰æˆ¦ç•¥ï¼ˆæœ‰æ–™ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æƒ³å®šï¼‰ -->
    <div class="bg-gradient-to-r from-trader-yellow/10 to-trader-card border border-trader-yellow/30 rounded-lg p-6">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-bold text-white">ğŸ“ ãƒˆãƒ¬ãƒ¼ãƒ‰æˆ¦ç•¥</h2>
            <span class="text-xs bg-trader-yellow/20 text-trader-yellow px-2 py-1 rounded">PREMIUM</span>
        </div>
        <div class="prose prose-invert max-w-none text-gray-300">
            <p class="text-trader-yellow mb-4">âš ï¸ ç™ºè¡¨ç›´å‰ã¯æ³¨æ–‡ãŒé€šã‚‰ãªã„ â†’ <strong>äº‹å‰ã«å…¨ã¦è¨­å®š</strong></p>
            <ol class="list-decimal list-inside space-y-3">
                <li><strong>æ–¹å‘æ„Ÿã‚’æ±ºã‚ã‚‹</strong>: FRBç™ºè¨€ã‹ã‚‰ãƒ‰ãƒ«ã®å¼·å¼±ã‚’åˆ¤æ–­</li>
                <li><strong>ç™ºè¡¨30åˆ†ã€œ1æ™‚é–“å‰ã«ã‚¨ãƒ³ãƒˆãƒªãƒ¼</strong>
                    <ul class="list-disc list-inside ml-4 text-sm text-gray-400 mt-1">
                        <li>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰æ‹¡å¤§å‰ã«ç´„å®šã•ã›ã‚‹</li>
                        <li>5000å††åˆ†ï¼ˆ1000é€šè²¨ or 0.01ãƒ­ãƒƒãƒˆï¼‰</li>
                    </ul>
                </li>
                <li><strong>åŒæ™‚ã«OCOæ³¨æ–‡ã‚’è¨­å®š</strong>
                    <ul class="list-disc list-inside ml-4 text-sm text-gray-400 mt-1">
                        <li>ãƒ­ã‚¹ã‚«ãƒƒãƒˆ: -50pipsï¼ˆ-500å††ï¼‰</li>
                        <li>åˆ©ç¢º: +100pipsã€œï¼ˆ+1000å††ã€œï¼‰</li>
                    </ul>
                </li>
                <li><strong>ç™ºè¡¨å¾Œã¯æ”¾ç½®</strong>: è‡ªå‹•ã§æ±ºæ¸ˆã•ã‚Œã‚‹ã®ã‚’å¾…ã¤</li>
            </ol>
            <div class="mt-4 p-3 bg-trader-border/30 rounded-lg text-sm">
                <p class="text-gray-400">ğŸ’¡ ãƒã‚¤ãƒ³ãƒˆ: ç™ºè¡¨æ™‚ã¯ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ãŒ10ã€œ30pipsé–‹ãã“ã¨ã‚‚ã€‚æˆè¡Œã¯å±é™ºã€‚</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
