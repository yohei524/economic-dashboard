{% extends "base.html" %}

{% block title %}é›‡ç”¨çµ±è¨ˆ {{ month }} | çµŒæ¸ˆæŒ‡æ¨™ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
        <div>
            <p class="text-pop-purple font-bold text-sm tracking-wider mb-1">ğŸ“Š NON-FARM PAYROLLS</p>
            <h1 class="text-3xl md:text-4xl font-black text-gray-800">é›‡ç”¨çµ±è¨ˆ</h1>
            <p class="text-gray-500 mt-1">{{ month }} åˆ†</p>
        </div>
        <!-- æœˆé¸æŠ -->
        <div class="flex items-center gap-2">
            <select id="month-select" class="glass-card px-4 py-2 rounded-xl font-medium text-gray-700 focus:outline-none focus:ring-2 focus:ring-pop-purple" onchange="location.href='/nfp/' + this.value">
                {% for nfp in all_nfp %}
                <option value="{{ nfp.month }}" {% if nfp.month == month %}selected{% endif %}>
                    {{ nfp.month }}ï¼ˆ{{ nfp.date }}ç™ºè¡¨ï¼‰
                </option>
                {% endfor %}
            </select>
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚«ãƒ¼ãƒ‰ -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- äºˆæƒ³ãƒ»çµæœã‚«ãƒ¼ãƒ‰ -->
        <div class="glass-card rounded-3xl p-6 shadow-lg">
            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                <span class="text-xl">ğŸ“ˆ</span>
                ãƒ‡ãƒ¼ã‚¿
            </h2>

            {% if schedule %}
            <div class="mb-4 p-3 rounded-xl bg-pop-purple/10">
                <p class="text-pop-purple text-sm font-medium">ç™ºè¡¨æ—¥æ™‚</p>
                <p class="text-gray-800 text-xl font-bold">{{ schedule.date }} 22:30 JST</p>
            </div>
            {% endif %}

            <div class="grid grid-cols-3 gap-3 mt-4">
                <div class="text-center p-4 rounded-2xl bg-gray-100">
                    <p class="text-gray-500 text-xs font-medium">å‰å›</p>
                    <p class="text-2xl font-black text-gray-700 mt-1">
                        {% if data.prev %}{{ data.prev }}ä¸‡{% else %}-{% endif %}
                    </p>
                </div>
                <div class="text-center p-4 rounded-2xl bg-gradient-to-br from-pop-blue/20 to-pop-cyan/20 border-2 border-pop-blue/30">
                    <p class="text-pop-blue text-xs font-medium">äºˆæƒ³</p>
                    <p class="text-2xl font-black text-pop-blue mt-1">
                        {% if data.forecast %}{{ data.forecast }}ä¸‡{% else %}-{% endif %}
                    </p>
                </div>
                <div class="text-center p-4 rounded-2xl {% if data.actual %}{% if data.actual > data.forecast %}bg-gradient-to-br from-pop-green/20 to-pop-cyan/20 border-2 border-pop-green/30{% else %}bg-gradient-to-br from-pop-red/20 to-pop-pink/20 border-2 border-pop-red/30{% endif %}{% else %}bg-gray-100{% endif %}">
                    <p class="{% if data.actual %}{% if data.actual > data.forecast %}text-pop-green{% else %}text-pop-red{% endif %}{% else %}text-gray-500{% endif %} text-xs font-medium">çµæœ</p>
                    <p class="text-2xl font-black {% if data.actual %}{% if data.actual > data.forecast %}text-pop-green{% else %}text-pop-red{% endif %}{% else %}text-gray-400{% endif %} mt-1">
                        {% if data.actual %}{{ data.actual }}ä¸‡{% else %}-{% endif %}
                    </p>
                </div>
            </div>

            {% if data.actual and data.forecast %}
            <div class="mt-4 p-4 rounded-2xl {% if data.actual > data.forecast %}bg-pop-green/10{% else %}bg-pop-red/10{% endif %}">
                <p class="text-gray-600 text-sm">ä¹–é›¢</p>
                <p class="text-2xl font-black {% if data.actual > data.forecast %}text-pop-green{% else %}text-pop-red{% endif %}">
                    {% if data.actual > data.forecast %}+{% endif %}{{ "%.1f"|format(data.actual - data.forecast) }}ä¸‡äºº
                </p>
                <p class="text-gray-500 text-sm mt-2">
                    {% if data.actual > data.forecast %}
                    ğŸ“ˆ äºˆæƒ³ã‚’ä¸Šå›ã‚‹ â†’ ãƒ‰ãƒ«è²·ã„ï¼ˆã‚»ã‚ªãƒªãƒ¼ï¼‰
                    {% else %}
                    ğŸ“‰ äºˆæƒ³ã‚’ä¸‹å›ã‚‹ â†’ ãƒ‰ãƒ«å£²ã‚Šï¼ˆã‚»ã‚ªãƒªãƒ¼ï¼‰
                    {% endif %}
                </p>
            </div>
            {% endif %}

            {% if data.market_reaction %}
            <div class="mt-4 p-4 rounded-2xl bg-gray-100">
                <p class="text-gray-500 text-sm">å¸‚å ´åå¿œ</p>
                <p class="text-xl font-bold text-gray-800">{{ data.market_reaction }}</p>
            </div>
            {% endif %}

            {% if data.notes %}
            <div class="mt-4 p-4 rounded-2xl bg-pop-yellow/10 border border-pop-yellow/30">
                <p class="text-pop-yellow text-sm font-medium">ğŸ“ ãƒ¡ãƒ¢</p>
                <p class="text-gray-700 mt-1">{{ data.notes }}</p>
            </div>
            {% endif %}
        </div>

        <!-- ç™ºè¡¨ç›´å¾Œã®å€¤å‹•ã -->
        <div class="glass-card rounded-3xl p-6 shadow-lg">
            <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                <span class="text-xl">ğŸ“‰</span>
                ç™ºè¡¨ç›´å¾Œã®å€¤å‹•ã
            </h2>

            {% if data.price_moves %}
            <div class="mb-4 p-3 rounded-xl bg-gray-100">
                <p class="text-gray-500 text-sm">ç™ºè¡¨æ™‚ USD/JPY</p>
                <p class="text-2xl font-black text-gray-800">{{ data.price_moves.release_price }}</p>
            </div>

            <div class="space-y-2">
                {% for label, move in data.price_moves.moves.items() %}
                <div class="flex items-center justify-between p-3 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors">
                    <span class="text-gray-600 font-medium">
                        {% if label == '5min_after' %}â±ï¸ 5åˆ†å¾Œ
                        {% elif label == '15min_after' %}â±ï¸ 15åˆ†å¾Œ
                        {% elif label == '30min_after' %}â±ï¸ 30åˆ†å¾Œ
                        {% elif label == '1h_after' %}â±ï¸ 1æ™‚é–“å¾Œ
                        {% else %}{{ label }}{% endif %}
                    </span>
                    <div class="text-right">
                        <span class="text-gray-700 font-medium">{{ move.price }}</span>
                        <span class="ml-2 font-bold px-2 py-1 rounded-lg {% if move.pips >= 0 %}bg-pop-green/20 text-pop-green{% else %}bg-pop-red/20 text-pop-red{% endif %}">
                            {% if move.pips >= 0 %}+{% endif %}{{ move.pips }}pips
                        </span>
                    </div>
                </div>
                {% endfor %}
            </div>

            <div class="mt-4 p-4 rounded-2xl {% if data.price_moves.max_move >= 0 %}bg-gradient-to-r from-pop-green/20 to-pop-cyan/20 border-2 border-pop-green/30{% else %}bg-gradient-to-r from-pop-red/20 to-pop-pink/20 border-2 border-pop-red/30{% endif %}">
                <p class="text-gray-600 text-sm">æœ€å¤§å¤‰å‹•</p>
                <p class="text-4xl font-black {% if data.price_moves.max_move >= 0 %}text-pop-green{% else %}text-pop-red{% endif %}">
                    {% if data.price_moves.max_move >= 0 %}+{% endif %}{{ data.price_moves.max_move }}pips
                </p>
            </div>
            {% else %}
            <div class="text-center py-12">
                <span class="text-6xl">ğŸ“Š</span>
                <p class="text-gray-400 mt-4">ç™ºè¡¨å¾Œã«ãƒ‡ãƒ¼ã‚¿ãŒè¿½åŠ ã•ã‚Œã¾ã™</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- é–¢é€£FRBç™ºè¨€ -->
    <div class="glass-card rounded-3xl p-6 shadow-lg">
        <h2 class="text-lg font-bold text-gray-800 mb-2 flex items-center gap-2">
            <span class="text-xl">ğŸ¦…</span>
            é–¢é€£FRBç™ºè¨€
        </h2>
        <p class="text-gray-500 text-sm mb-4">å‰å›NFPã€œä»Šå›NFPé–“ã®ç™ºè¨€</p>

        {% if speeches %}
        <div class="space-y-3 max-h-96 overflow-y-auto">
            {% for speech in speeches %}
            <div class="p-4 rounded-2xl bg-gray-50 hover:bg-gray-100 transition-colors">
                <div class="flex items-center justify-between">
                    <span class="font-bold text-gray-800">{{ speech.official }}</span>
                    <span class="text-gray-400 text-sm">{{ speech.date }}</span>
                </div>
                <p class="text-gray-600 text-sm mt-2">{{ speech.summary }}</p>
                <div class="flex items-center mt-3 gap-2">
                    {% if speech.stance == 'hawkish' %}
                    <span class="text-xs px-3 py-1 rounded-full bg-pop-red/20 text-pop-red font-bold">ğŸ¦… ã‚¿ã‚«æ´¾</span>
                    {% elif speech.stance == 'dovish' %}
                    <span class="text-xs px-3 py-1 rounded-full bg-pop-green/20 text-pop-green font-bold">ğŸ•Šï¸ ãƒãƒˆæ´¾</span>
                    {% else %}
                    <span class="text-xs px-3 py-1 rounded-full bg-gray-200 text-gray-500 font-bold">â– ä¸­ç«‹</span>
                    {% endif %}
                    {% if speech.market_reaction %}
                    <span class="text-xs text-gray-400">{{ speech.market_reaction }}</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-8">
            <span class="text-5xl">ğŸ¦…</span>
            <p class="text-gray-400 mt-4">ã¾ã ç™ºè¨€ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
        </div>
        {% endif %}
    </div>

    <!-- éå»ã®é›‡ç”¨çµ±è¨ˆå±¥æ­´ -->
    <div class="glass-card rounded-3xl p-6 shadow-lg">
        <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
            <span class="text-xl">ğŸ“œ</span>
            éå»ã®é›‡ç”¨çµ±è¨ˆ
        </h2>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="border-b-2 border-gray-200">
                        <th class="px-4 py-3 text-left text-sm font-bold text-gray-500">å¯¾è±¡æœˆ</th>
                        <th class="px-4 py-3 text-right text-sm font-bold text-gray-500">äºˆæƒ³</th>
                        <th class="px-4 py-3 text-right text-sm font-bold text-gray-500">çµæœ</th>
                        <th class="px-4 py-3 text-right text-sm font-bold text-gray-500">ä¹–é›¢</th>
                        <th class="px-4 py-3 text-left text-sm font-bold text-gray-500">åå¿œ</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    {% for m, d in nfp_history.items()|sort(reverse=True) %}
                    {% if d.actual %}
                    <tr class="hover:bg-gray-50 transition-colors {% if m == month %}bg-pop-purple/5{% endif %}">
                        <td class="px-4 py-3">
                            <a href="/nfp/{{ m }}" class="text-pop-purple font-bold hover:underline">{{ m }}</a>
                        </td>
                        <td class="px-4 py-3 text-right text-gray-700 font-medium">{{ d.forecast }}ä¸‡</td>
                        <td class="px-4 py-3 text-right font-bold {% if d.actual > d.forecast %}text-pop-green{% else %}text-pop-red{% endif %}">
                            {{ d.actual }}ä¸‡
                        </td>
                        <td class="px-4 py-3 text-right font-bold {% if d.actual > d.forecast %}text-pop-green{% else %}text-pop-red{% endif %}">
                            {% if d.actual > d.forecast %}+{% endif %}{{ "%.1f"|format(d.actual - d.forecast) }}
                        </td>
                        <td class="px-4 py-3 text-gray-500 text-sm">{{ d.market_reaction or '-' }}</td>
                    </tr>
                    {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- ãƒˆãƒ¬ãƒ¼ãƒ‰æˆ¦ç•¥ï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼‰ -->
    <div class="glass-card rounded-3xl p-6 shadow-lg border-2 border-pop-yellow/30 bg-gradient-to-br from-pop-yellow/5 to-pop-orange/5">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                <span class="text-xl">ğŸ“</span>
                ãƒˆãƒ¬ãƒ¼ãƒ‰æˆ¦ç•¥
            </h2>
            <span class="text-xs bg-gradient-to-r from-pop-yellow to-pop-orange text-white px-3 py-1 rounded-full font-bold">
                âœ¨ PREMIUM
            </span>
        </div>
        <div class="prose max-w-none text-gray-700">
            <div class="p-4 rounded-2xl bg-pop-yellow/10 border border-pop-yellow/30 mb-4">
                <p class="text-pop-orange font-bold">âš ï¸ ç™ºè¡¨ç›´å‰ã¯æ³¨æ–‡ãŒé€šã‚‰ãªã„ â†’ äº‹å‰ã«å…¨ã¦è¨­å®šï¼</p>
            </div>
            <ol class="list-decimal list-inside space-y-4">
                <li class="p-3 rounded-xl bg-white/50">
                    <span class="font-bold text-gray-800">æ–¹å‘æ„Ÿã‚’æ±ºã‚ã‚‹</span>
                    <p class="text-gray-600 text-sm mt-1 ml-6">FRBç™ºè¨€ã‹ã‚‰ãƒ‰ãƒ«ã®å¼·å¼±ã‚’åˆ¤æ–­</p>
                </li>
                <li class="p-3 rounded-xl bg-white/50">
                    <span class="font-bold text-gray-800">ç™ºè¡¨30åˆ†ã€œ1æ™‚é–“å‰ã«ã‚¨ãƒ³ãƒˆãƒªãƒ¼</span>
                    <ul class="text-gray-600 text-sm mt-1 ml-6 space-y-1">
                        <li>â€¢ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰æ‹¡å¤§å‰ã«ç´„å®šã•ã›ã‚‹</li>
                        <li>â€¢ 5000å††åˆ†ï¼ˆ1000é€šè²¨ or 0.01ãƒ­ãƒƒãƒˆï¼‰</li>
                    </ul>
                </li>
                <li class="p-3 rounded-xl bg-white/50">
                    <span class="font-bold text-gray-800">åŒæ™‚ã«OCOæ³¨æ–‡ã‚’è¨­å®š</span>
                    <ul class="text-gray-600 text-sm mt-1 ml-6 space-y-1">
                        <li>â€¢ ğŸ”´ ãƒ­ã‚¹ã‚«ãƒƒãƒˆ: -50pipsï¼ˆ-500å††ï¼‰</li>
                        <li>â€¢ ğŸŸ¢ åˆ©ç¢º: +100pipsã€œï¼ˆ+1000å††ã€œï¼‰</li>
                    </ul>
                </li>
                <li class="p-3 rounded-xl bg-white/50">
                    <span class="font-bold text-gray-800">ç™ºè¡¨å¾Œã¯æ”¾ç½®</span>
                    <p class="text-gray-600 text-sm mt-1 ml-6">è‡ªå‹•ã§æ±ºæ¸ˆã•ã‚Œã‚‹ã®ã‚’å¾…ã¤</p>
                </li>
            </ol>
            <div class="mt-4 p-4 rounded-2xl bg-pop-blue/10 border border-pop-blue/30">
                <p class="text-pop-blue text-sm">ğŸ’¡ <span class="font-bold">ãƒã‚¤ãƒ³ãƒˆ:</span> ç™ºè¡¨æ™‚ã¯ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ãŒ10ã€œ30pipsé–‹ãã“ã¨ã‚‚ã€‚æˆè¡Œã¯å±é™ºï¼</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
